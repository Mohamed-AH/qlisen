/**
 * Test script for the new analyze-full endpoint
 * Tests post-processing analysis with sample transcripts
 */

const path = require('path');
const quranService = require('./services/quranService');
const RecitationAnalyzer = require('./services/recitationAnalyzer');

async function test() {
    console.log('ğŸ§ª Testing Post-Processing Analysis System\n');

    // Initialize Quran service
    console.log('ğŸ“š Loading Quran data...');
    await quranService.init(path.join(__dirname, '../data'));
    console.log('âœ… Quran data loaded\n');

    // Create analyzer
    const analyzer = new RecitationAnalyzer(quranService);

    // Test 1: Perfect Al-Fatiha
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('Test 1: Perfect Al-Fatiha Recitation');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

    const perfectFatiha = `
        Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…
        Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ø±Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠÙ†
        Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…
        Ù…Ø§Ù„Ùƒ ÙŠÙˆÙ… Ø§Ù„Ø¯ÙŠÙ†
        Ø¥ÙŠØ§Ùƒ Ù†Ø¹Ø¨Ø¯ ÙˆØ¥ÙŠØ§Ùƒ Ù†Ø³ØªØ¹ÙŠÙ†
        Ø§Ù‡Ø¯Ù†Ø§ Ø§Ù„ØµØ±Ø§Ø· Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…
        ØµØ±Ø§Ø· Ø§Ù„Ø°ÙŠÙ† Ø£Ù†Ø¹Ù…Øª Ø¹Ù„ÙŠÙ‡Ù… ØºÙŠØ± Ø§Ù„Ù…ØºØ¶ÙˆØ¨ Ø¹Ù„ÙŠÙ‡Ù… ÙˆÙ„Ø§ Ø§Ù„Ø¶Ø§Ù„ÙŠÙ†
    `;

    let result = await analyzer.analyzeFull(perfectFatiha, { duration: 30000 });
    console.log('Result:', JSON.stringify(result, null, 2));
    console.log('\n');

    // Test 2: Al-Fatiha with speech recognition errors (like user's example)
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('Test 2: Al-Fatiha with Speech Recognition Errors');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

    const noisyFatiha = `
        Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ… Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ø±Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠÙ† Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…
        Ù…Ø§Ù„Ùƒ ÙŠÙˆÙ… Ø§Ù„Ø¯ÙŠÙ† Ø¥ÙŠØ§Ùƒ Ù†Ø¹Ø¨Ø¯ Y ÙŠØ§ ÙƒØ§Ù† Ù†Ø³ØªØ¹ÙŠÙ† Ù…ÙŠÙ† Ø§ÙŠÙ‡ Ø¯ÙŠÙ† Ø§Ù„ØµØ±Ø§Ø· Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…
        ØµØ±Ø§Ø· Ø§Ù„Ø°ÙŠÙ† Ø§Ù„Ù†Ø¹Ù… Ø£Ù†Øª Ø¹Ù„ÙŠÙ‡Ù… ØºÙŠØ± Ø§Ù„Ù…ØºØ¶ÙˆØ¨ Ø¹Ù„ÙŠÙ‡Ù… ÙˆÙ„Ø§ Ø§Ù„Ø¶ÙˆØ¡ Ø§Ù„Ù„ÙŠ Ù…Ø§
    `;

    result = await analyzer.analyzeFull(noisyFatiha, { duration: 30000 });
    console.log('Result:', JSON.stringify(result, null, 2));
    console.log('\n');

    // Test 3: Al-Fatiha with skipped verse
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('Test 3: Al-Fatiha with Verse 3 Skipped');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

    const skippedVerse = `
        Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…
        Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ Ø±Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠÙ†
        Ù…Ø§Ù„Ùƒ ÙŠÙˆÙ… Ø§Ù„Ø¯ÙŠÙ†
        Ø¥ÙŠØ§Ùƒ Ù†Ø¹Ø¨Ø¯ ÙˆØ¥ÙŠØ§Ùƒ Ù†Ø³ØªØ¹ÙŠÙ†
        Ø§Ù‡Ø¯Ù†Ø§ Ø§Ù„ØµØ±Ø§Ø· Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ…
        ØµØ±Ø§Ø· Ø§Ù„Ø°ÙŠÙ† Ø£Ù†Ø¹Ù…Øª Ø¹Ù„ÙŠÙ‡Ù… ØºÙŠØ± Ø§Ù„Ù…ØºØ¶ÙˆØ¨ Ø¹Ù„ÙŠÙ‡Ù… ÙˆÙ„Ø§ Ø§Ù„Ø¶Ø§Ù„ÙŠÙ†
    `;

    result = await analyzer.analyzeFull(skippedVerse, { duration: 25000 });
    console.log('Result:', JSON.stringify(result, null, 2));
    console.log('\n');

    // Test 4: Al-Ikhlas
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('Test 4: Al-Ikhlas');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

    const ikhlas = `
        Ù‚Ù„ Ù‡Ùˆ Ø§Ù„Ù„Ù‡ Ø£Ø­Ø¯
        Ø§Ù„Ù„Ù‡ Ø§Ù„ØµÙ…Ø¯
        Ù„Ù… ÙŠÙ„Ø¯ ÙˆÙ„Ù… ÙŠÙˆÙ„Ø¯
        ÙˆÙ„Ù… ÙŠÙƒÙ† Ù„Ù‡ ÙƒÙÙˆØ§ Ø£Ø­Ø¯
    `;

    result = await analyzer.analyzeFull(ikhlas, { duration: 15000 });
    console.log('Result:', JSON.stringify(result, null, 2));
    console.log('\n');

    console.log('âœ… All tests completed!');
    process.exit(0);
}

test().catch(error => {
    console.error('âŒ Test failed:', error);
    process.exit(1);
});
